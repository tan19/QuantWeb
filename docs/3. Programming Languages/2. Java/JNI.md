# JNI
A **native method** is a Java method (either an instance method or a class method) whose implementation is written in another programming language such as C. We show in this tutorial how to integrate native methods into Java classes.



<a href="https://www.baeldung.com/jni" target="_blank">JNI Tutorial</a>

## 1. Write the Java Code
??? Note "Source Code"
    === "HelloWorldJNI.java"
        ``` Java
        public class HelloWorldJNI {

            static {
                System.loadLibrary("native");
            }

            public static void main(String[] args) {

                new HelloWorldJNI().sayHello();

                System.out.println(new HelloWorldJNI().sumIntegers(1, 2));

                System.out.println(new HelloWorldJNI().sayHelloToMe("Michael", false));

                UserData ud = new HelloWorldJNI().createUser("Michael", 100.0);
                System.out.println(new HelloWorldJNI().printUserData(ud));
            }

            private native void sayHello();
            private native long sumIntegers(int first, int second);
            private native String sayHelloToMe(String name, boolean isFemale);
            public native UserData createUser(String name, double balance);
            public native String printUserData(UserData user);
        }
        ```
    === "UserData.java"
        ``` Java
        package HelloWorldJNI;

        public class UserData {
            public String name;
            public double balance;

            public String getUserInfo() {
                return "[name]=" + name + ", [balance]=" + balance;
            }
        }
        ```
    === "HelloWorldJNI.cpp"
        ``` C++
        #include "<PATH_TO_THE_JAVA_HEADER_FILE>"
        #include <iostream>

        struct myClass{
        int a = 0;
        };

        JNIEXPORT void JNICALL Java_HelloWorldJNI_sayHello
        (JNIEnv* env, jobject thisObject) {
            std::cout << "Hello from C++!" << std::endl;
            std::cout << myClass().a << std::endl;
        }

        JNIEXPORT jlong JNICALL Java_HelloWorldJNI_sumIntegers 
        (JNIEnv* env, jobject thisObject, jint first, jint second) {
            std::cout << "C++: The numbers received are : " << first << " and " << second << std::endl;
            return (long)first + (long)second;
        }

        JNIEXPORT jstring JNICALL Java_HelloWorldJNI_sayHelloToMe 
        (JNIEnv* env, jobject thisObject, jstring name, jboolean isFemale) {
            const char* nameCharPointer = env->GetStringUTFChars(name, NULL);
            std::string title;
            if(isFemale) {
                title = "Ms. ";
            }
            else {
                title = "Mr. ";
            }

            std::string fullName = title + nameCharPointer;
            return env->NewStringUTF(fullName.c_str());
        }

        JNIEXPORT jobject JNICALL Java_HelloWorldJNI_createUser
        (JNIEnv *env, jobject thisObject, jstring name, jdouble balance) {
        
            // Create the object of the class UserData
            jclass userDataClass = env->FindClass("UserData");
            jobject newUserData = env->AllocObject(userDataClass);
            
            // Get the UserData fields to be set
            jfieldID nameField = env->GetFieldID(userDataClass , "name", "Ljava/lang/String;");
            jfieldID balanceField = env->GetFieldID(userDataClass , "balance", "D");
            
            env->SetObjectField(newUserData, nameField, name);
            env->SetDoubleField(newUserData, balanceField, balance);
            
            return newUserData;
        }

        JNIEXPORT jstring JNICALL Java_HelloWorldJNI_printUserData
        (JNIEnv *env, jobject thisObject, jobject userData) {
            
            // Find the id of the Java method to be called
            jclass userDataClass=env->GetObjectClass(userData);
            jmethodID methodId=env->GetMethodID(userDataClass, "getUserInfo", "()Ljava/lang/String;");

            jstring result = (jstring)env->CallObjectMethod(userData, methodId);
            return result;
        }
        ```
    === "HelloWorldJNI.h"
        ``` C++
        /* DO NOT EDIT THIS FILE - it is machine generated */
        #include <jni.h>
        /* Header for class HelloWorldJNI */

        #ifndef _Included_HelloWorldJNI
        #define _Included_HelloWorldJNI
        #ifdef __cplusplus
        extern "C" {
        #endif
        /*
        * Class:     HelloWorldJNI
        * Method:    sayHello
        * Signature: ()V
        */
        JNIEXPORT void JNICALL Java_HelloWorldJNI_sayHello
        (JNIEnv *, jobject);

        /*
        * Class:     HelloWorldJNI
        * Method:    sumIntegers
        * Signature: (II)J
        */
        JNIEXPORT jlong JNICALL Java_HelloWorldJNI_sumIntegers
        (JNIEnv *, jobject, jint, jint);

        /*
        * Class:     HelloWorldJNI
        * Method:    sayHelloToMe
        * Signature: (Ljava/lang/String;Z)Ljava/lang/String;
        */
        JNIEXPORT jstring JNICALL Java_HelloWorldJNI_sayHelloToMe
        (JNIEnv *, jobject, jstring, jboolean);

        /*
        * Class:     HelloWorldJNI
        * Method:    createUser
        * Signature: (Ljava/lang/String;D)LUserData;
        */
        JNIEXPORT jobject JNICALL Java_HelloWorldJNI_createUser
        (JNIEnv *, jobject, jstring, jdouble);

        /*
        * Class:     HelloWorldJNI
        * Method:    printUserData
        * Signature: (LUserData;)Ljava/lang/String;
        */
        JNIEXPORT jstring JNICALL Java_HelloWorldJNI_printUserData
        (JNIEnv *, jobject, jobject);

        #ifdef __cplusplus
        }
        #endif
        #endif
        ```

    

## 2. Build and Run
### Build the java header file "HelloWorldJNI.h"
``` Java
${Java Source Path} > javac -h JNI_Header $FileDir$/$FileName$
```

### Build the dll "native.o"
``` Java
${C++ Implementation Path} > g++ -c ^
-I"C:\Program Files\Java\jdk-16.0.1\include" ^
-I"C:\Program Files\Java\jdk-16.0.1\include\win32" ^
HelloWorldJNI_HelloWorldJNI.cpp ^
-o HelloWorldJNI_HelloWorldJNI.o ^
&& g++ -shared -o native.dll HelloWorldJNI_HelloWorldJNI.o
```

### Link and Run
``` Java
${Java Source Path} > java -cp <PATH_TO_THE_JAVA_CLASS> ^
-Djava.library.path=<PATH_TO_THE_C++_DLL> ^
HelloWorldJNI
```